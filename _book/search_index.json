[["geostatistics.html", "Geostatistics Final Summary Chapter 1 Geostatistics 1.1 Targeted Problems 1.2 Spatial Data Example 1.3 Stationary Process 1.4 Variogram Model Fitting", " Geostatistics Final Summary Yan Ren 2022-01-31 Chapter 1 Geostatistics 1.1 Targeted Problems Spatial data is considered as a random process \\(\\{Z(s),s\\in D\\}\\) in this part. \\(D\\): a is a fixed subset of \\(\\mathbb{R}^d\\) with positive d-dimensional volume. \\(s\\): locations varies continuously throughout the region \\(D\\). Set coalash dataset as an example (Figure 1.1). \\(D\\) is the region with values. and \\(s\\) indicates percent of coalash in this location. Many kinds of exploratory statistics can be applied here to test stationarity, local stationarity and so on. Figure 1.1: Scatter Plot of CoalAsh Percent The key idea in this chapter is to model the above random process \\(\\{Z(s),s\\in D\\}\\) with values on known locations. Then inference of unknown locations can be made. 1.2 Spatial Data Example 1.2.1 Main Concepts Variogram is the crucial parameter of geostatistics. Intrinsic Stationarity Based on the random process mentioned above, intrinsic stationarity is defined through first differences \\[\\begin{equation} \\begin{aligned} &amp;E\\{Z(s+h) - Z(s)\\} = 0,\\\\ &amp;Var\\{Z(s+h) - Z(s)\\} = 2\\gamma(h). \\end{aligned} \\tag{1.1} \\end{equation}\\] Variogram Variogram is \\(2\\gamma(h)\\) in the definition of intrinsic stationarity. 1.2.2 Esitimation of Variogram 1.2.2.1 Estimator The classical estimator of the variogram: \\[\\begin{equation} 2 \\hat{\\gamma}(h) \\equiv \\frac{1}{|N(h)|} \\sum_{N(h)}\\left(Z\\left(s_{i}\\right)-Z\\left(s_{j}\\right)\\right)^{2} \\tag{1.2} \\end{equation}\\] Estimator (1.2) is unbiased. However, it is badly affected by atypical observations due to square operation. For an approximately symmetric distribution, there is a more robust approach to the estimation of the variogram by transforming the problem to location estimation. For a Gaussian process, we have: \\[\\begin{equation} 2 \\bar{\\gamma}(\\mathrm{h}) \\equiv\\left\\{\\frac{1}{|N(\\mathrm{~h})|} \\sum_{N(\\mathrm{~h})}\\left|Z\\left(\\mathrm{~s}_{i}\\right)-Z\\left(\\mathrm{~s}_{j}\\right)\\right|^{1 / 2}\\right\\}^{4} /\\left(0.457+\\frac{0.494}{|N(\\mathrm{~h})|}\\right). \\tag{1.3} \\end{equation}\\] Estimator (1.3) is also unbiased. 1.2.2.2 Visualization Variogram Cloud: Cousin to estimator (1.2), variogram cloud is a useful diagnostic tool. Similarly, it can be badly affected by atypical observations. Variogram cloud in east-west direction of coalash data is shown in Figure 1.2 Here are steps to draw variogram cloud. Group points with \\(y\\) value; Calculate the classical estimator of the variogram \\(\\frac{1}{|N(h)|}\\cdot \\displaystyle\\sum_{N(h)}{(z(s_i) - z(s_j))^2}\\). \\(N(h) = \\{(s_i, s_j):\\ s_i + he = s_j\\}\\) \\(e\\): the unit vector of east direction (positive x axis) Notice that y values of each pair \\((s_i, s_j)\\) are the same. But they may vary among pairs. Plot the corresponding boxplot. x axis: distance \\(h\\) y axis: the classical estimator of the variogram with parameter h, Units are \\((\\% coal ash)^2\\) Figure 1.2: Variogram Cloud in the East-West Direction Square-Root-Differences Cloud: The only different from variogram cloud: calculate the classical estimator of the variogram \\(\\frac{1}{|N(h)|}\\cdot \\displaystyle\\sum_{N(h)}{|Z(s_i) - Z(s_j)|^\\frac12}\\). Figure 1.3: Square-Root-Differences Cloud in the East-West Direction Pocket Plot The Pocket Plot tries to identify a localized area as being atypical with respect to a stationary mode. We plotting Pocket Plot 1.4 in the North-South Direction follows the steps as below: Get \\(\\{|N_{jk}|\\}\\) matrix (symmetric). Denote \\(|N_{jk}|\\) as the value of row \\(j\\) and column \\(k\\) of the matrix \\(N_{jk} = \\{(s_j, s_k):\\ s_j \\in row_j, s_k \\in row_k, x_{s_j} = x_{s_k}\\}\\) \\(|N_{jk}|\\) means total pair number between row \\(j\\) and \\(k\\) Get \\(\\{Y_{jk}\\}\\) matrix (symmetric). For there are 23 distinct value in y axis, the matrix has the dim of \\(23\\times 23\\) Denote \\(Y_{jk}\\) as the value of row \\(j\\) and column \\(k\\) of the matrix, we have \\(Y_{jk} = \\frac{1}{N_{jk}}\\displaystyle\\sum_{N_{jk}}|z(s_j) - z(s_k)|^{\\frac12}\\) Calculate \\(Y_h\\) vector. \\(Y_h\\) is the weighted mean of \\(Y_{jk}\\) where \\(|j - k| = h\\) Calculate \\(P_{jk} = Y_{jk} - Y_h\\) Plot the boxplot. x axis: index \\(j\\) y axis: \\(P_{jk}\\). There should be 23 points of each columns. Figure 1.4: Pocket Plot in the North-South Direction 1.2.3 Decomposition The goal is to deompose data into large- and small-scale variation. Large-Scale Variation: The grand, column, and row effects. Small-Scale Variation: The residual. Like ANOVA, \\(F\\) test within-rows and within-columns is first raised. However, it suffer from correlation among data points. Another additive decomposition follows the idea of \\(data = all + row + column + residual\\). Then for value of a location \\((i,j)\\) can be decomposed as \\(Y_{ij} = Y_{..} + (Y_{i.}-Y_{..}) + (Y_{.j}-Y_{..}) + (Y_{ij}-Y_{i.}-Y_{.j}+Y_{..})\\), where a subscripted dot (·) denotes averaging over that subscript. This can be settled by median polishing method. Median Polishing Successively sweeps medians out of rows, then columns, then rows, then columns, and so on, accumulating them in “row,” “column,” and “all” registers, and leaves behind the table of residuals. 1.3 Stationary Process The concept of intrinsic stationarity has been introduced in section 1.2.1. Second-order (weak) stationarity is addressed in this section. It should be noticed that intrinsic stationarity is weaker than second-order stationarity. Intrinsic Stationarity Based on the random process mentioned above, intrinsic stationarity is defined through first differences \\[\\begin{equation} \\begin{aligned} &amp;E\\{Z(s+h) - Z(s)\\} = 0,\\\\ &amp;Var\\{Z(s+h) - Z(s)\\} = 2\\gamma(h). \\end{aligned} \\tag{1.1} \\end{equation}\\] Second-Order (Weak) Stationarity When the random process meets the following assuptions, the process is second-order (weak) stationary. \\[\\begin{equation} \\begin{aligned} &amp;E(Z(s)) = 0, \\ \\forall s \\in D \\\\ &amp;Cov(Z(s_i), Z(s_j)) = C(s_i - s_j), \\ \\forall s_i, s_j \\in D \\end{aligned} \\tag{1.4} \\end{equation}\\] Other important concepts related to stationary process as listed below. Covariogram: Function \\(C(.)\\) in (1.4). Isotropy: When \\(C(s_i - s_j)\\) only depends on \\(\\Vert s_i - s_j\\Vert\\) but not the direction of \\(s_i - s_j\\), then \\(C(.)\\) is isotropic. Anisotropy: Contrary to isotropy, when \\(C(s_i - s_j)\\) depends on both \\(\\Vert s_i - s_j\\Vert\\) and the direction of \\(s_i - s_j\\), then \\(C(.)\\) is anisotropic. Caused by underlying physical process evolving differentlly in space. The Euclidean space is not appropriate for measuring distance between locations. Ergodicity: The property which allows expectations over the \\(\\Omega \\in \\mathbb{R}^d}\\) space to be estimated by spatial averages. Strong Stationarity: Strong stationarity refers to the property that the distribution of any finite sample of \\(Z(.)\\) is independent of locations (translation invariant). 1.3.1 Variogram &amp; Covariogram Recall section 1.2.1, variogram is defined as \\(2\\gamma(h) = Var(Z(s+h) - z(s)),\\ \\forall s, s+h\\in D\\). Some exploratory analysis of variogram has been seen in the example. Some related concepts are listed below. Semiv-variogram: \\(\\gamma(h) = \\frac12 Var(Z(s+h) - z(s))\\). Relative Variogram: Variogram of transformed data. Sometimes, simple transformations lead to intrinsic stationary processes. Nugget Effect: \\(c_0\\) is named as nugget effect, where \\(c_0 = \\lim_{h\\to 0}\\gamma(h)\\). When \\(h\\to 0\\), \\(Var(Z(s+h) - Z(s))\\to Var(0)\\), which should be exactly 0. This implies that nuggest effect should be 0 if assumptions are all met. Causes of \\(c_0 &gt; 0\\): Measurement error; Microscale variation. Estimation: Extrapolating the variogram estimates fro lags closest to zero. for practically, it is impossible to calculate variogram with scale less than \\(\\min \\left\\{\\left\\|s_{i}-s_{j}\\right\\|, 1 \\leq i \\leq j \\leq n\\right\\}\\). Still: The quantity \\(C(0)\\) is called still. \\(C(0) - c_0\\) is called the partial still. Here are some other properties related to variogram and covariogram. Variogram is symmetric: \\(\\gamma(h) = \\gamma(-h),\\ \\gamma(0) = 0\\). Speed of increase: \\(\\lim _{|h| \\rightarrow \\infty} \\frac{2 \\gamma(h)}{|h|^{2}}=0\\), which means that it is necessary for a variogram to increase slower than \\(|h|^2\\). Under stationarity, the covariance function \\(C(h)\\) is necessarily positive definite. Under intrinsic stationarity, variograms must be conditionally negative-definite. 1.3.2 Estimation of Variogram &amp; Covariogram 1.3.2.1 Estimator of Variogram Considering the definition of variogram, the most direct solution is moment estimator \\[2 \\hat{\\gamma}(h) \\equiv \\frac{1}{|N(h)|} \\sum_{N(h)}\\left(Z\\left(s_{i}\\right)-Z\\left(s_{j}\\right)\\right)^{2}\\] where \\(N(h) = \\{(s_i, s_j): s_i - s_j = h\\}\\) Generally speaking, the variogram estimator can be expressed as a quadratic form (1.5) \\[\\begin{equation} 2\\hat \\gamma (h) = Z&#39;A(h)Z \\tag{1.5} \\end{equation}\\] Denote \\(Var(Z)=\\Sigma\\), then the means and variance of \\(2\\gamma(h)\\) can be calculated as: \\[\\begin{equation} \\begin{aligned} E(2 \\hat{\\gamma}(h)) &amp;=\\operatorname{trace}(A(h) \\Sigma) \\\\ \\operatorname{var}(2 \\hat{\\gamma}(h)) &amp;=2 \\operatorname{trace}(A(h) \\Sigma A(h) \\Sigma) \\end{aligned} \\tag{1.6} \\end{equation}\\] 1.3.2.2 Estimator of Covariogram For Covariogram, estimators are in line with basic ideas of variogram estimators. In the same way, the most direct thought of moment estimator is as Formula (??) \\[\\begin{equation} \\hat{C}(h) \\equiv \\frac{1}{|N(h)|} \\displaystyle\\sum_{N(b)}\\left(Z\\left(s_{i}\\right)-\\bar{Z}\\right)\\left(Z\\left(s_{j}\\right)-\\bar{Z}\\right) \\end{equation}\\] where \\(\\bar{Z}=\\sum_{i=1}^{n} Z\\left(s_{i}\\right) / n\\). 1.3.3 Validity Not all functions can be variograms or covariogram. There are some prerequisites ensuring validity of them. 1.3.3.1 Valid Variogram Under intrinsic stationarity, variogram must be conditionally negative definite, which means (1.7) \\[\\begin{equation} \\sum_{i, j} a_{i} a_{j} 2 \\gamma\\left(s_{i}-s_{j}\\right) \\leq 0$ for $\\sum a_{i}=0 \\tag{1.7} \\end{equation}\\] Continuous conditionally negative definite function corresponds to an intrinsically stationary stochastic process. Valid variogram forms a convex cone. Theorem 1.1 provides us with several ways to check variogram validity. Theorem 1.1 If \\(2 \\gamma(.)\\) is continuous on \\(\\mathbb{R}^{d}\\) and \\(\\gamma(0)=0\\), then the following are equivalent: \\(2 \\gamma(.)\\) is conditionally negative definite; For all \\(a&gt;0\\), \\(\\exp (-a \\gamma(.))\\) is positive definite. \\(2 \\gamma(h)=Q(h)+\\int \\frac{1-\\cos \\left(\\omega^{\\prime} h\\right)}{\\|\\omega\\|^{2}} G(d \\omega)\\), where \\(Q(.) \\geq 0\\) is a quadratic form and \\(G(.)\\) is a positive, symmetric measure continuous at the origin that \\(\\int\\left(1+\\|\\omega\\|^{2}\\right)^{-1} G(d \\omega)&lt;\\infty\\). 1.3.3.2 Valid Covariogram Under second-order stationarity, the covariance function \\(C(h)\\) is necessarily positive definite. That is, for any real numbers \\(a_1,...,a_n\\) and locations \\(s_1,...,s_n\\), ({i=1}^{n} a{i} Z(s_{i}))={i, j} a{i} a_{j} C(s_{i}-s_{j}) \\tag{1.8} \\end{equation} Spectral representation form Accoding to Theorem 1.2, a continuous function \\(C(h)\\) is positive-definite if and only if it has a spectral representation \\(C(h)=\\int \\cos \\left(\\omega^{\\prime} h\\right) G(d \\omega)\\), where \\(G\\) is a positive bounded symmetric measure. Spectral density and distribution \\(G/C(0)\\) is the spectral distribution function If \\(G(d \\omega)=g(\\omega) d \\omega\\), \\(g/C(0)\\) is the spectral density function. Theorem 1.2 Theorem For any normalized continuous positive-definite function \\(f\\) on \\(G\\) (normalization here means that \\(f\\) is 1 at the unit of \\(G\\) ), there exists a unique probability measure \\(\\mu\\) on \\(\\widehat{G}\\) such that \\[ f(g)=\\int_{\\widehat{G}} \\xi(g) d \\mu(\\xi) \\] 1.4 Variogram Model Fitting Considering variogram validity prerequisites, variogram estimators presented in section 1.3.2.1 can not be used directly for spatial prediction. The key idea of variogram model fitting is to search for a valid variogram that is closest to the data. When there are more than one valid model, probably from method illustrated from section 1.4.2 to 1.4.3.1, corss validation is an important tool for model checking. 1.4.1 EDA Check Before Model Fitting Check assumptions such as constant mean, constant marginal variance, stationarity, intrinsic stationarity; Check the Gaussian assumption; If the data is approximately normally distributed, modelling the first two moments are quite enough. If some evidence of non-Gaussianity is found, the variogram estimator defined in section 1.3.2.1 is still valid, because they can be viewed as moment estimators which are independent of Gaussian assumption. Isolate suspicious observations for further study; Choose a appropriate parametric variogram model. From now on, we consider 1.4.2 Maximum Likelihood Estimator Assumptions: Suppose the data is generated from a stationary Gaussian process with a parametric variogram model \\(P=\\{2 \\gamma: 2 \\gamma(h)=2 \\gamma(h ; \\theta) ; \\theta \\in \\Theta\\}\\). Then the goal is to estimate \\(\\theta\\). Suppose we also observed some covariates \\(X_1,...,X_n\\) which are linearly related to \\(Z\\). Model: \\(Z=\\left(Z\\left(s_{1}\\right), \\ldots, Z\\left(s_{n}\\right)\\right) \\sim N(X \\beta, \\Sigma(\\theta))\\) where \\(\\Sigma(\\theta)=\\left(\\operatorname{cov}\\left(Z\\left(s_{i}\\right), Z\\left(s_{j}\\right)\\right)\\right)\\). Goal: find parameter estimation \\((\\hat \\beta, \\hat \\theta)\\) to minimize loglikelihood function (1.9). Where there is no spatial correlation, this amounts to a simple linear regression model. The solution is \\(\\Sigma(\\theta)=\\sigma^{2} I\\) and \\(\\theta=\\sigma^{2}.\\) General solution: \\(\\hat{\\sigma}^{2}=\\sum\\left(Z\\left(s_{i}\\right)-X_{i} \\hat{\\beta}\\right)^{2} / n\\) \\(\\hat{\\sigma}^{2}\\) is biased. For \\(E\\left(\\hat{\\sigma}^{2}\\right)=(n-q) / n \\sigma^{2}\\), the larger \\(q\\) is, the more biased the estimator gets. \\[\\begin{equation} L(\\beta, \\theta)=\\frac{n}{2} \\log (2 \\pi)+\\frac{1}{2} \\log |\\Sigma(\\theta)|+\\frac{1}{2}(Z-X \\beta)^{\\prime} \\Sigma(\\theta)^{-1}(Z-X \\beta) \\tag{1.9} \\end{equation}\\] Improvements: To de-bias \\(\\hat \\theta\\), which is \\(\\hat{\\sigma}^{2}\\) is out case, restricted maximum likelihood estimator (EMLE) is raised. Estimator form: \\(\\hat{\\theta}=\\int_{\\beta} \\exp (-L(\\beta, \\theta))(d \\beta)\\) Once variogram is estimated, then covariogram can be easily get by \\(2\\gamma(h) = 2(C(0) - C(h))\\) 1.4.3 MINQ Estimation Applicable Situation: the variance matrix of the data is linear in its parameters, i.e. \\(\\Sigma(\\theta)=\\theta_{1} \\Sigma_{1}+\\ldots, \\theta_{m} \\Sigma_{m}\\). The MINQ approach is particularly appropriate for a variance components model. 1.4.3.1 Least Squares Esimator The main idea of Least Squares Esimator (LSE) is the same as least square regression. The goal function to minimize is the square error. \\[\\begin{equation} \\sum_{j=1}^{K}\\left\\{2 \\gamma^{\\#}(h(j) e)-2 \\gamma(h(j) e ; \\theta)\\right\\}^{2} \\tag{1.10} \\end{equation}\\] If we not \\(2 \\boldsymbol{\\gamma}^{\\#}=\\left(2 \\gamma^{\\#}(h(1)), \\ldots, 2 \\gamma^{\\#}(h(K))\\right)\\) with covariance matrix \\(\\operatorname{var}\\left(2 \\boldsymbol{\\gamma}^{\\#}\\right)=V\\), the goal to minimize is tranformed into \\[\\begin{equation} \\left(2 \\boldsymbol{\\gamma}^{\\#}-2 \\boldsymbol{\\gamma}(\\theta)\\right)^{\\prime} V^{-1}\\left(2 \\boldsymbol{\\gamma}^{\\#}-2 \\boldsymbol{\\gamma}(\\theta)\\right) \\tag{1.11} \\end{equation}\\] Notice that although a direction vector \\(e\\) is included in formula (1.10), multiple directions could also be accounted for by adding the appropriate squared differences. Drawbacks: The least squares estimator takes no cognizance of the distributional variation and covariation of the generic estimator. Improvement: Weighted Least Squares (WLS): Replace \\(V\\) by a diagonal matrix \\(\\left.\\Delta=\\operatorname{diag}\\left(\\operatorname{var}\\left(2 \\gamma^{\\#}(h(1))\\right), \\ldots, 2 \\gamma^{\\#}(h(K))\\right)\\right)\\). Generalized Least Squares (GLS): use just the (asymptotic) second-order structure of the variogram estimator and does not make assumptions about the whole distribution of the data. When there is little knowledge of the true model, GLS is a good startingg choice. "],["spatial-prediction-and-kriging.html", "Chapter 2 Spatial Prediction and Kriging 2.1 Scale of variation 2.2 Ordinary Kriging 2.3 Cokriging 2.4 Robust Kriging 2.5 Universal Kriging", " Chapter 2 Spatial Prediction and Kriging Recall decomposition of variogram illustrated in section 1.2.3, large scale and small scale variation both contribute to \\(Z\\). Continue with this idea, we model random process \\(\\{Z(s), s\\in D \\subset \\mathbb{R}^d\\}\\) as: \\[\\begin{equation} Z(s)=S(s)+e(s), s \\in D. \\tag{2.1} \\end{equation}\\] where \\(e(.)\\) is a white-noise measurement-error process. Notice that when it comes to prediction, we are interested in noiseless value, which means \\(S(s)\\) in formula (2.1). A known functional \\(g(S(s))\\) can also be studied. Block average prediction value can be calculated by \\(g(Z(.))=\\int_{B} Z(s) d s /|B|\\), where \\(B\\subset \\mathbb{R}^d\\) whose location and geometry are known. 2.1 Scale of variation Scale Scale can have two different meanings: The observational scale of \\(Z(s)\\) which means system error due to the recording instruments are just accurate up to a certain level. The spatial scale of \\(s\\). The observations are based on a certain aggregation and are taken a certain distance apart. Extend the decomposition introduced in section (2.1) even further, we consider a more detailed decomposition as formula (2.2). \\[\\begin{equation} Z(s) = \\mu(s) + W(s) + \\eta(s) + \\epsilon(s) \\tag{2.2} \\end{equation}\\] where Large-Scale Variation: \\(\\mu(s)\\), the deterministic mean structure. Smooth Small-Scale Variation: \\(W(s)\\), a zero-mean, \\(L_2\\)-continuous, intrinsically stationary random process with variogram range larger than \\(\\min \\left\\{\\left\\|s_{i}-s_{j}\\right\\|, 1 \\leq i \\leq j \\leq n\\right\\}\\). Microscale Variation: \\(\\eta(s)\\), a zero-mean, intrinsically stationary process with variogram range smaller than \\(\\min \\left\\{\\left\\|s_{i}-s_{j}\\right\\|, 1 \\leq i \\leq j \\leq n\\right\\}\\), and independent of \\(W(s)\\). Measurement Error or Noise: \\(\\epsilon(s)\\), a zero-mean white-noise process and independent of \\(W(s)\\) and \\(\\eta(s)\\). \\(Var(\\epsilon(s)):= c_{ME}\\). Based on decomposition (2.2), the variogram can be computed as below: \\[\\begin{equation} 2 \\gamma_{Z}(.)=2 \\gamma_{w}(.)+2 \\gamma_{\\eta}(.)+2 c_{M E}. \\end{equation}\\] Thus, nugget effect mentioned in section 1.3.1 can be decomposed as well as \\(c_0 = c_{ME} + c_{MS}\\), where \\(c_{MS} = \\displaystyle\\lim_{|h|\\to0}\\gamma_\\eta(h)\\) indicates nugget effect of the microscale process \\(\\eta(.)\\), and \\(c_{ME}\\) is defined as \\(Var(\\epsilon(s))\\). The general goal is to decompose \\(Z(s)\\) as signal term and noise term. The decomposition is not unique. 2.2 Ordinary Kriging Kriging is a minimum-mean-squared-error method of spatial prediction that usually depends on the second-order properties of the random process \\(Z(.)\\). 2.2.1 Model Introduction Suppose we have data \\((Z(s_1),...,Z(s_n))\\prime\\). Denote the generic predictor as \\(p(Z, B)\\) where \\(Z\\) means the targeted value and \\(B\\) implies the region the predicting location lies. Then we define ordinary kriging model. Ordinary Kriging The general form of ordinary kriging is \\(Z(s) = \\mu + \\delta(s):= \\mu + W(s) + \\eta(s) + \\epsilon(s)\\). Here, \\(\\mu\\) is the mean of the process, a constant but unknown. Predictor of Ordinary Kriging: a linear predictor is adopted. That is \\(p(Z ; B)=\\sum_{i=1}^{n} \\lambda_{i} Z\\left(s_{i}\\right)\\) where \\(\\sum_{i=1}^{n} \\lambda_{i}=1\\). Loss Function of Ordinary Kriging: We are considering squared-error loss here. That is \\(L(Z(B), p(Z, B))=(Z(B)-p(Z, B))^{2}\\). With the assumptions and settings above, the problem has been transformed into a constrained optimization one. It can be addressed by Lagrange method. In our case, Lagrange function is \\[\\begin{equation} -\\lambda^{\\top} \\Gamma \\lambda+2 \\lambda^{\\top} \\mathbf{r}-2 m\\left(\\lambda^{\\top} 1_{n}-1\\right) \\tag{2.3} \\end{equation}\\] and the corresponding normal equation can be writen as \\[\\begin{equation} \\begin{gathered} \\Gamma \\lambda+m 1_{n}=\\mathbf{r} \\\\ \\lambda^{\\top} 1_{n}=1. \\end{gathered} \\tag{2.4} \\end{equation}\\] Notice, second-order stationary is not mandatory for kriging, it is required for estimation of the covariogram. 2.2.2 Effect of Variogram Estimation 2.2.2.1 Still Still \\(\\sigma_{Z}^{2}=\\lim _{|h| \\rightarrow 0} \\gamma_{Z}(h)\\), \\(\\sigma_Z^2\\) is called still, which indicates the limit value of \\(\\gamma\\). Theoretically, the sill of \\(Z\\) is \\(\\sigma_{Z}^{2}(\\cdot)=\\sigma_{W}^{2}(\\cdot)+\\sigma_{\\eta}^{2}(\\cdot)+c_{M E}\\). Practically, the sill of \\(Z\\) is estimated as \\(\\sigma_{W}^{2}(\\cdot)+c_0 \\leq \\sigma_{Z}^{2}(\\cdot)\\). It can be useful in estimating nugget effect. Practically, nugget effect is usually estimated by \\(\\sigma_{\\eta}^{2}(\\cdot)+c_{M E}\\) rather than \\(c_0\\). 2.2.2.2 Range Range The smallest value of \\(\\Vert r_0\\Vert\\) for which \\(2 \\gamma\\left(\\mathbf{r}_{0}(1+\\epsilon)\\right)=2 C(0),\\) for any \\(\\epsilon&gt;0\\) is called the range of the variogram in the direction of \\(r_0/\\Vert r_0 \\Vert\\). Still can be interpreted as the lag beyond which \\(Z(s)\\) and \\(Z(s + a)\\) are uncorrelated. Thus \\(Cov(Z(s), Z(s+h)) = 0,\\ h &gt; a\\). Still influence covariogram. 2.3 Cokriging Cokriging is actually the multivariate version of kriging. Suppose data are \\(k \\times 1\\) vectors \\((\\mathbf Z(s_1),...,\\mathbf Z(s_n))^\\prime\\). Cokriging The Cokriging model with constant mean is \\[\\begin{equation} \\begin{aligned} \\mathbb{E}(\\mathbf{Z}(s)) &amp;=\\boldsymbol{\\mu}, s \\in D \\\\ \\operatorname{cov}(\\mathbf{Z}(s), \\mathbf{Z}(u)) &amp;=C(s, u), s, u \\in D \\end{aligned} \\tag{2.5} \\end{equation}\\] Predictor of Cokriging: the linear predictor can be writen as formula (2.6) now. \\[\\begin{equation} p_{1}\\left(\\mathbf{Z} ; s_{0}\\right)=\\sum_{i=1}^{n} \\sum_{j=1}^{k} \\lambda_{j i} Z_{j}\\left(s_{i}\\right) \\tag{2.6} \\end{equation}\\] When \\(\\sum_{i=1}^{n} \\lambda_{1 i}=1\\) and \\(\\sum_{i=1}^{n} \\lambda_{j i}=0 \\text { for } j \\neq 1\\), the predictor is unbiased. Risk of Cokriging: \\(E\\left(Z_{1}\\left(s_{0}\\right)-\\sum_{i=1}^{n} \\sum_{j=1}^{k} \\lambda_{j i} Z_{j}\\left(s_{i}\\right)\\right)^{2}\\) Notice that data are usually not satisfying all assumption. Take Gaussian distribution assumption as an example, data transformation may be taken before kriging is modeled. 2.4 Robust Kriging Even with the operation of data transformation beforehead, outliers may occur frequently and badly influence parameter estimators in out model. Linear predictors applied by kriging model is sensitive to outlying observations. Robust kriging is raised here to settle outlier problem. Instead of directly cancelling outliers, the main idea of robust kriging is downweighting the unusual observation. The predictor now is: \\[\\begin{equation} p(Z ; B)=\\sum_{i=1}^{n} \\lambda_{i} Z\\left(s_{i}\\right) w\\left(Z\\left(s_{i}\\right)\\right)=\\sum_{i=1}^{n} \\lambda_{i} Z^{(e)}\\left(s_{i}\\right) \\tag{2.7} \\end{equation}\\] where \\(0\\leq W(.)\\leq 1\\) is the weight functin, and \\(Z^{(e)}(s)\\) is the modified data. The algorithm of operating robust kriging is as below: Estimate the variogram using one of the robust estimators (Section 2.4.3 in Book) and fit a valid variogram model. Compute the kriging weights \\(\\hat{Z}_{-j}\\left(s_{j}\\right)=\\sum_{i \\neq j} \\lambda_{j i} Z\\left(s_{i}\\right)\\). That is, predict \\(Z(s_j)\\) without using \\(Z(s_j)\\). Let \\(\\sigma^2_{j}(s_j)\\) be the associated kriging variance. The subsript \\(j\\) means we do not use \\(Z(s_j)\\) in the predition. Use the weights \\(\\lambda_{ji}:i\\neq j\\) to obtain a robust prediction of \\(Z(s_j)\\) from the data \\[\\begin{equation} Z_{-j}^{@}\\left(s_{j}\\right)=\\text { weighted median of }\\left(\\left\\{Z_{i}: i \\neq j\\right\\} ;\\left\\{\\lambda_{j i}: i \\neq j\\right\\}\\right) \\tag{2.8} \\end{equation}\\] We use \\(Z_{-j}^{@}\\left(s_{j}\\right)\\) and \\(\\sigma_{-j}^{2}\\left(s_{j}\\right)\\) to judge whether \\(Z\\left(s_{j}\\right)\\) is clean or contaminated. Edit \\(Z(s_j)\\) by replacing it with the Winsorized version \\[\\begin{equation} Z^{(e)}\\left(s_{j}\\right)=\\left\\{\\begin{array}{cl} Z_{-j}^{@}\\left(s_{j}\\right)+c \\sigma_{-j}\\left(s_{j}\\right) &amp; \\text { if } Z\\left(s_{j}\\right)&gt;Z_{-j}^{@}\\left(s_{j}\\right)+c \\sigma_{-j}\\left(s_{j}\\right) \\\\ Z\\left(s_{j}\\right) &amp; \\left|Z\\left(s_{j}\\right)-Z_{-j}^{@}\\left(s_{j}\\right)\\right|&lt;c \\sigma_{-j}\\left(s_{j}\\right) \\\\ Z_{-j}^{@}\\left(s_{j}\\right)-c \\sigma_{-j}\\left(s_{j}\\right) &amp; Z\\left(s_{j}\\right)&lt;Z_{-j}^{@}\\left(s_{j}\\right)-c \\sigma_{-j}\\left(s_{j}\\right) \\end{array}\\right. \\tag{2.9} \\end{equation}\\] Predict with the modified data \\(Z^{(e)}(s_j)\\) \\[\\begin{equation} \\hat{p}(Z, B)=\\sum_{i=1}^{n} \\lambda_{i} Z^{(e)}\\left(s_{j}\\right) \\tag{2.10} \\end{equation}\\] 2.5 Universal Kriging Extend to constant mean assumption of ordinary kriging, Suppose the mean is a linear combination of known functions \\(\\left\\{f_{0}(s), \\ldots, f_{p}(s)\\right\\}\\), we get universal kriging. Universal Kriging The general form of Universal Kriging is \\[\\begin{equation} \\left\\{f_{0}(s), \\ldots, f_{p}(s)\\right\\}. \\tag{2.11} \\end{equation}\\] It can also be writen in matrix form as \\[\\begin{equation} \\mathbf{Z} = \\mathbf{X}\\beta + \\mathbf{\\delta}. \\tag{2.12} \\end{equation}\\] where \\(\\beta=(\\beta_0,...,\\beta_p)\\) is an unknown vector of parameters and \\(\\delta(.)\\) is a zero-mean intrinsically stationary random process with variogram \\(2\\gamma(.)\\) Predictor of Universal Kriging: \\(p\\left(\\mathbf{Z} ; s_{0}\\right)=\\lambda^{\\top} \\mathbf{Z}, \\text { for } \\lambda^{\\top} \\mathbf{X}=\\mathbf{x}^{\\top}\\) where \\(\\mathbf{x} = (f_1(s_0),...,f_p(s_0))^\\prime\\) Risk of Universal Kriging: \\(E\\left(Z\\left(s_{0}\\right)-\\sum_{i=1}^{n} \\lambda_{i} Z\\left(s_{i}\\right)\\right)^{2}=-\\lambda^{\\top} \\Gamma \\lambda+2 \\lambda^{\\top} \\mathbf{r}\\) Similary to ordinary kriging, the problem is tranformed into a optimization addressed by Lagrange method. Lagrange function here is \\(-\\lambda^{\\top} \\Gamma \\lambda+2 \\lambda^{\\top} \\mathbf{r}-2 \\mathbf{m}^{\\top}\\left(\\mathbf{X}^{\\top} \\lambda-\\mathbf{x}\\right)\\). The solution \\(\\lambda\\) and \\(m\\) can be derived by the normal equation. "],["spatial-models-on-lattices.html", "Chapter 3 Spatial Models on Lattices 3.1 Lattices 3.2 Spatial Models for Lattice Data 3.3 Markov Random Fields 3.4 Conditionally Specified Spatial Models 3.5 Simultaneously Specified Spatial Models 3.6 Space-Time Models", " Chapter 3 Spatial Models on Lattices Instead of continuous index set considered in Part 1, this part is concerned with the situation where the index set \\(D\\) is a countable collection of spatial sites at which data are observed. The collection \\(D\\) of such sites is called a lattice, which is then supplemented with neighborhood information. 3.1 Lattices Latices Lattice refers to a countable collection of (spatial) sites, either spatially regular or irregular. Set Sudden Infant Death Syndrome (SIDS) in North Carolina, 1974-1978 as an example. The lattice form of the data can be drawn as Figure 3.1. Figure 3.1: Lattice Figure of Sudden Infant Death Syndrome (SIDS) in North Carolina, 1974-1978 Neighborhoods A site \\(k\\) is defined to be a neighbor of site \\(i\\) if the conditional distribution of \\(Z\\left(s_{i}\\right)\\), given all other site values, depends functionally on \\(z\\left(s_{k}\\right)\\), for \\(k \\neq i\\). Also define \\[\\begin{equation} N_{i} \\equiv\\{k: k \\text { is a neighbor of } i\\} \\tag{3.1} \\end{equation}\\] to be the neighborhood set of site \\(i\\). Neighborhoods is important in lattice data. In SIDS data example, neighborhood relationships are drawn by blue line in Figure 3.1.Here, counties whose seats are closer than 30 miles are deemed neighbors. For instance, if we consider the bold red points, four blue points around it are neighbors. 3.2 Spatial Models for Lattice Data In spatial domain, the conditional approach 3.2.2 and the simultaneous approach 3.2.1 result in different models. 3.2.1 Simultaneous Spatial Models 3.2.1.1 General Form For simplicity, consider the square lattice in the plane \\(\\mathbb{R}^2\\). \\[\\begin{equation} D=\\{s=(u, v): u=\\ldots,-2,-1,0,1,2, \\ldots ; v=\\ldots,-2,-1,0,1,2, \\ldots\\} \\tag{3.2} \\end{equation}\\] The joint approach is to assume \\[\\begin{equation} \\operatorname{Pr}(\\mathbf{z})=\\prod_{(u, v) \\in D} Q_{u v}(z(u, v) ; z(u-1, v), z(u+1, v), z(u, v-1), z(u, v+1)). \\tag{3.3} \\end{equation}\\] Equation (3.3) suggests that the probability of values on a specific location is determined by values of its neighbors. Model definition of simultaneous spatial models \\[\\begin{equation} \\phi\\left(T_{1}, T_{2}\\right) Z(u, v)=\\epsilon(u, v) \\tag{3.4} \\end{equation}\\] where \\[\\begin{equation} \\left\\{\\begin{aligned} &amp; T_{1} Z(u, v)=Z(u+1, v) \\\\ &amp; T_{1}^{-1} Z(u, v)=Z(u-1, v) \\\\ &amp; T_{2} Z(u, v)=Z(u, v+1) \\\\ &amp; T_{2}^{-1} Z(u, v)=Z(u, v-1) \\end{aligned} \\right. \\tag{3.5} \\end{equation}\\] and \\[\\begin{equation} \\phi\\left(T_{1}, T_{2}\\right)=\\sum_{i} \\sum_{j} a_{i j} T_{1}^{i} T_{2}^{j} \\tag{3.6} \\end{equation}\\] Notice that \\(\\phi(c_1, c_2)\\neq 0\\) for any complex number \\(|c_1| = |c_2| = 1\\) must be met to ensure obtaining a stationary process. 3.2.1.2 Simultaneously Specified Spatial Gaussian Models For this section, assume that \\(\\{Z(s): s \\in D\\}=\\left\\{Z\\left(s_{i}\\right): i=1, \\ldots, n\\right\\}\\) is defined on a finite subset of the integer lattice in the plane. Suppose \\(\\boldsymbol{\\epsilon}=\\left(\\epsilon\\left(s_{1}\\right), \\ldots, \\epsilon\\left(s_{n}\\right)\\right) \\sim \\operatorname{Gua}(0, \\Lambda)\\), where \\(\\Lambda=\\sigma^{2} I\\) and \\(B=\\left(b_{i j}\\right)\\), where \\(b_{ij} = 0\\) means \\(s_1, s_2\\) are independent. If \\(I - B\\) is invertable, then simultaneously specified spatial gaussian model is writen as \\[\\begin{equation} (I-B)(\\mathbf{Z}-\\mu)=\\epsilon \\tag{3.7} \\end{equation}\\] Equally, \\[\\begin{equation} Z\\left(s_{i}\\right)=\\mu_{i}+\\sum_{j=1}^{n} b_{i j}\\left(Z\\left(s_{j}\\right)-\\mu_{j}\\right)+\\epsilon_{i} \\tag{3.8} \\end{equation}\\] From equation (3.7), we have \\(\\mathbf{Z} \\sim \\operatorname{Gau}\\left(\\mu,(I-B)^{-1} \\Lambda\\left(I-B^{\\top}\\right)^{-1}\\right)\\). Equation (3.8), this is a spatial analogue of the autoregressive model. Note that \\(\\left.\\left.\\operatorname{Cov}(\\boldsymbol{\\epsilon}, \\mathbf{Z})=\\operatorname{cov}\\left(\\boldsymbol{\\epsilon},(I-B)^{-1}\\right) \\boldsymbol{\\epsilon}\\right)=\\Lambda\\left(I-B^{\\top}\\right)^{-1}\\right)\\) is not diagonal, which means the error is not independent of the autoregressive variables. It theoretically suspects the consistency of least-squares estimators. 3.2.2 Conditional Spatial Models 3.2.2.1 General Form The spatial conditional approach assumes \\[\\begin{equation} \\begin{aligned} &amp;\\mathbf{P}(z(u, v) \\mid\\{z(k, l):(k, l) \\neq(u, v)\\}) \\\\ \\quad=&amp;\\mathbf{P}(z(u, v) \\mid z(u-1, v), z(u+1, v), z(u, v-1), z(u, v+1)), \\text { for all }(u, v)^{\\prime} \\in D. \\end{aligned} \\tag{3.9} \\end{equation}\\] The conditional approach also suggests that the probability of values on a specific location is determined by values of its neighbors, but in a different way from simultaneous approach in section 3.2.1 3.2.2.2 Conditionally Specified Spatial Gaussian Models For Gaussian data defined in section 3.2.1.2, the conditional model can be written as \\[\\begin{equation} \\left.Z\\left(s_{i}\\right) \\mid\\left\\{Z\\left(s_{j}\\right): j \\neq i\\right\\}\\right) \\sim \\operatorname{Gau}\\left(\\theta_{i}\\left(\\left\\{Z\\left(s_{j}\\right): j \\neq i\\right\\}\\right), \\tau_{i}^{2}\\right) \\tag{3.10} \\end{equation}\\] Addditionally, we suppose ”pairwise-only dependence” between sites. Therefore we can write \\(\\theta_i\\) as a linear function \\[\\begin{equation} \\theta_{i}\\left(\\left\\{Z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=\\mu_{i}+\\sum_{j=1}^{n} c_{i j}\\left(z\\left(s_{j}\\right)-\\mu_{j}\\right) \\tag{3.11} \\end{equation}\\] where \\(c_{i j} \\tau_{j}^{2}=c_{j i} \\tau_{i}^{2}, c_{i i}=0\\). \\(c_{i k}=0\\) means there is no dependence between sites \\(s_i\\) and \\(s_k\\). Then we have \\[\\begin{equation} \\mathbf{Z} \\sim \\operatorname{Gau}\\left(\\mu,(I-C)^{-1} M\\right) \\tag{3.12} \\end{equation}\\] where \\(M=\\operatorname{diag}\\left(\\tau_{1}^{2}, \\ldots, \\tau_{n}^{2}\\right)\\). If we note \\(\\nu:=(I-C)(\\mathbf{Z}-\\mu)\\), conditionally specified spatial gaussian models can also be writen as \\[\\begin{equation} Z\\left(s_{i}\\right)=\\mu_{i}+\\sum_{j=1}^{n} c_{i j}\\left(Z\\left(s_{j}\\right)-\\mu_{j}\\right)+\\nu_{i} \\tag{3.13} \\end{equation}\\] 3.2.2.3 Comparison Equation (3.13) and equation (3.8) are comparable. SG and CG is equivalent if \\((I-C)^{-1} M=(I-B)^{-1} \\Lambda\\left(I-B^{\\top}\\right)^{-1}\\). Any SG can be represented as a CG, but not necessarily vice versa. 3.3 Markov Random Fields 3.3.1 Preparation Before Markov Random Fields, some concepts and conditions need to be specified. Positivity Condition Suppose on each lattice node, we observe a discrete random variable \\(Z(s_i)\\) (continuous random variables can be similarly treated). Define the domain of \\(Z(s_i)\\) as \\(\\zeta_{i}=\\left\\{z\\left(s_{i}\\right): \\mathbf{P}\\left(z\\left(s_{i}\\right)\\right)&gt;0\\right\\}\\). Thus \\(\\boldsymbol{\\zeta}=\\left\\{\\mathbf{z}=\\left(z\\left(s_{1}\\right), \\ldots, z\\left(s_{n}\\right)\\right): \\mathbf{P}(z)&gt;0\\right\\}\\) indicates the domain of \\((Z(s_1),...,, Z(s_n))\\). Positivity condition says that \\[\\begin{equation} \\zeta=\\zeta_{1} \\times \\cdots \\times \\zeta_{n}. \\tag{3.14} \\end{equation}\\] In other words, positivity condition means indepence of domains in dimensions Theorem 3.1 [Factorization Theorem] Suppose the variables \\(\\left\\{\\mathrm{Z}\\left(s_{i}\\right): i=1, \\ldots, n\\right\\}\\) have joint probability mass function \\(\\mathbf{P}(\\mathbf{z})\\), whose support \\(\\zeta\\) satisfies the positivity condition. Then, \\[\\begin{equation} \\frac{\\mathbf{P}(\\mathbf{z})}{\\mathbf{P}(\\mathbf{y})}=\\prod_{i=1}^{n} \\frac{\\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid z\\left(s_{1}\\right), \\cdots, z\\left(s_{i-1}\\right), y\\left(s_{i+1}\\right), \\cdots, y\\left(s_{n}\\right)\\right)}{\\mathbf{P}\\left(y\\left(s_{i}\\right) \\mid z\\left(s_{1}\\right), \\cdots, z\\left(s_{i-1}\\right), y\\left(s_{i+1}\\right), \\cdots, y\\left(s_{n}\\right)\\right)} \\tag{3.15} \\end{equation}\\] where \\(\\mathbf{z}=\\left(z\\left(s_{1}\\right), \\cdots, z\\left(s_{n}\\right)\\right), \\mathbf{y}=\\left(y\\left(s_{1}\\right), \\ldots, y\\left(s_{n}\\right)\\right) \\in \\boldsymbol{\\zeta} .\\) There are two ways to model. If we model through joint distribution, conditional distribution is easily derived. However, if we start from conditional distribution, joint distribution may not be valid. In case of this, Factorization Theorem (3.15) is proposed to eliminate invalid joint distribution. Positivity condition and factorization theorem also works for continuous variable. The ordering of the variables \\(\\left(Z\\left(s_{1}\\right), \\cdots, Z\\left(s_{n}\\right)\\right)\\) do not affect the left hand of equation (3.15), but do affect the right hand. Neighbors Formal definition of neighbors is already given as (3.1) in section 3.1 Clique A clique is defined to be a set of sites that consists either of a single site or of sites that are all neighbors of each other. A clique can ben understood as an undirected graph. 3.3.2 Markov Random Field Having some knowledge of graphs, Markov random field can be introduced now. Markov Random Field Any probability measure whose conditional distributions define a neighborhood structure \\({N_i: i = 1,...,n}\\) is defined to be a Markov random field. Another important concept in Markov Random Field, which contains the same informations as \\(\\mathbf{P}(\\mathbf{z})\\). Negpotential Function The Negpotential Function \\(Q\\) is defined as \\[\\begin{equation} Q(\\mathbf{z})=\\log \\left\\{\\frac{\\mathbf{P}(\\mathbf{z})}{\\mathbf{P}(\\mathbf{0})}\\right\\}, \\quad \\mathbf{z} \\in \\boldsymbol{\\zeta} \\tag{3.16} \\end{equation}\\] which is also called log-likelihood ratio. Negpotential function is equivalent to knowledge of \\(\\mathbf{P}(\\mathbf{z})\\) for \\[\\begin{equation} \\mathbf{P}(\\mathbf{z})=\\frac{\\exp (Q(\\mathbf{z}))}{\\sum_{\\mathbf{y} \\in \\zeta} \\exp (Q(\\mathbf{y}))} \\tag{3.17} \\end{equation}\\] Theorem 3.2 [Properites of the negpotential function Q] \\[\\begin{equation} \\exp \\left(Q(\\mathbf{z})-Q\\left(\\mathbf{z}_{i}\\right)\\right)=\\frac{\\mathbf{P}(\\mathbf{z})}{\\mathbf{P}\\left(\\mathbf{z}_{i}\\right)}=\\frac{\\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)}{\\mathbf{P}\\left(0\\left(s_{i}\\right) \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)} \\tag{3.18} \\end{equation}\\] where \\(\\mathbf{z}_{i}=\\left(z\\left(s_{1}\\right), \\cdots, z\\left(s_{i-1}\\right), 0, z\\left(s_{i+1}\\right), \\ldots, z\\left(s_{n}\\right)\\right)^{\\prime}\\) and \\(0\\left(s_{i}\\right)\\) denotes the event \\(Z\\left(s_{i}\\right)=0\\). \\(Q\\) can be expanded uniquely on \\(\\zeta\\) as \\[\\begin{equation} \\begin{aligned} Q(\\mathbf{z})=&amp; \\sum_{1 \\leq i \\leq n} z\\left(s_{i}\\right) G_{i}\\left(z\\left(s_{i}\\right)\\right)+\\sum_{1 \\leq i&lt;j \\leq n} z\\left(s_{i}\\right) z\\left(s_{j}\\right) G_{i j}\\left(z\\left(s_{i}\\right), z\\left(s_{j}\\right)\\right)+\\cdots \\\\ &amp;+z\\left(s_{1}\\right) \\cdots z\\left(s_{n}\\right) G_{1} \\cdots n\\left(z\\left(s_{1}\\right), \\cdots, z\\left(s_{n}\\right)\\right), \\quad \\mathbf{z} \\in \\boldsymbol{\\zeta} . \\end{aligned} \\tag{3.19} \\end{equation}\\] Theorem ?? implies that the expansion of \\(Q(z)\\) is actually made up of conditional probabilities. The pairwise interaction term in \\(Q(\\mathbf{z})\\) (3.19) is: \\[\\begin{equation} \\begin{aligned} z &amp;\\left(s_{i}\\right) z\\left(s_{j}\\right) G_{i j}\\left(z\\left(s_{i}\\right), z\\left(s_{j}\\right)\\right) \\\\ =&amp; Q\\left(0, \\cdots, 0, z\\left(s_{i}\\right), 0, \\cdots, 0, z\\left(s_{j}\\right), 0, \\cdots, 0\\right)-Q\\left(0, \\cdots, 0, z\\left(s_{j}\\right), 0, \\cdots, 0\\right) \\\\ &amp;+Q(0, \\cdots, 0)-Q\\left(0, \\cdots, 0, z\\left(s_{i}\\right), 0, \\cdots, 0\\right) \\\\ =&amp; \\log \\left[\\frac{\\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid z\\left(s_{j}\\right),\\left\\{0\\left(s_{k}\\right): k \\neq i, j\\right\\}\\right)}{\\mathbf{P}\\left(0\\left(s_{i}\\right) \\mid z\\left(s_{j}\\right),\\left\\{0\\left(s_{k}\\right): k \\neq i, j\\right\\}\\right)} \\frac{\\mathbf{P}\\left(0\\left(s_{i}\\right) \\mid\\left\\{0\\left(s_{k}\\right): k \\neq i\\right\\}\\right)}{\\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid\\left\\{0\\left(s_{j}\\right): j \\neq i\\right\\}\\right)}\\right] \\end{aligned} \\tag{3.20} \\end{equation}\\] Recall that if we start from conditional distribution, joint distribution may not be valid. With some conditions, joint distribution is valid. One more concept is to introduce. Well-Defined G Functions The consistency conditions on the conditional probabilities (needed for reconstruction of a joint probability) can then be expressed as those conditions needed to yield well-defined G functions. 3.3.3 Hammersley-Clifford Theorem Theorem 3.3 Hammersley-Clifford Theorem Suppose that \\(\\mathbf{Z}\\) is distributed according to a Markov random field on \\(\\boldsymbol{\\zeta}\\) that satisfies the positivity condition. Then, the negpotential function \\(Q(.)\\) given by \\[\\begin{equation} \\begin{aligned} Q(\\mathbf{z})=&amp; \\sum_{1 \\leq i \\leq n} z\\left(\\mathbf{s}_{i}\\right) G_{i}\\left(z\\left(\\mathbf{s}_{i}\\right)\\right)+\\sum_{1 \\leq i&lt;j \\leq n} z\\left(\\mathbf{s}_{i}\\right) z\\left(\\mathbf{s}_{j}\\right) G_{i j}\\left(z\\left(\\mathbf{s}_{i}\\right), z\\left(\\mathbf{s}_{j}\\right)\\right) \\\\ &amp;+\\sum_{1 \\leq i&lt;j&lt;k \\leq n} z\\left(\\mathbf{s}_{i}\\right) z\\left(\\mathbf{s}_{j}\\right) z\\left(\\mathbf{s}_{k}\\right) G_{i j k}\\left(z\\left(\\mathbf{s}_{i}\\right), z\\left(\\mathbf{s}_{j}\\right), z\\left(\\mathbf{s}_{k}\\right)\\right)+\\cdots \\\\ &amp;+z\\left(\\mathbf{s}_{1}\\right) \\cdots z\\left(\\mathbf{s}_{n}\\right) G_{1 \\cdots n}\\left(z\\left(\\mathbf{s}_{1}\\right), \\ldots, z\\left(\\mathbf{s}_{n}\\right)\\right), \\quad \\mathbf{z} \\in \\zeta . \\end{aligned} \\tag{3.21} \\end{equation}\\] must satisfy the property that if sites \\(i, j, \\ldots, s\\) do not form a clique, then \\(G_{i j \\cdots s}(.)=0\\). Hammersley-Clifford theorem indicates negpotential function \\(Q(.)\\)’s property within a clique. 3.3.4 Pairwise-Only Dependence Pairwise-only means there is no directly stacked influence between sites who is not direct neighbors to each other. For simplicity and universality, from now on we consider only exponential distribution family. If there is non priori information, the exponential distribution is a good choice. Exponential Distribution A random variable follows a single parameter exponential distribution if \\(p(x \\mid \\eta)=h(x) \\exp \\{\\eta t(x)-a(\\eta)\\}\\) Suppose the one-parameter exponential family is used to model the conditional distribution: \\[\\begin{equation} \\begin{aligned} \\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=&amp; \\exp \\left[A_{i}\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right) B_{i}\\left(z\\left(s_{i}\\right)\\right)\\right.\\\\ &amp;\\left.+C_{i}\\left(z\\left(s_{i}\\right)\\right)+D_{i}\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)\\right] \\end{aligned} \\tag{3.22} \\end{equation}\\] Theorem 3.4 [Besag’s Theorem] Assume equation (3.22) and pairwise-only dependence between sites, i.e., all \\(G_{A}(.)=0\\) for any \\(A\\) whose number of distinct elements is 3 or more. Then \\[\\begin{equation} A_{i}\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=\\alpha_{i}+\\sum_{j=1}^{n} \\theta_{i j} B_{j}\\left(z\\left(s_{j}\\right)\\right), i=1, \\cdots, n, \\tag{3.23} \\end{equation}\\] where \\(\\theta_{i j}=\\theta_{j i}, \\theta_{i i}=0\\), and \\(\\theta_{i k}=0\\) for \\(k \\notin N_{i}\\). As a consequence of the theorem, \\(Q(z)\\) can be expressed as \\[\\begin{equation} Q(\\mathbf{z})=\\sum_{i=1}^{n}\\left\\{\\alpha_{i} B_{i}\\left(z\\left(s_{i}\\right)\\right)+C_{i}\\left(z\\left(s_{i}\\right)\\right)\\right\\}+\\sum_{1 \\leq i&lt;j \\leq n} \\theta_{i j} B_{i}\\left(z\\left(s_{i}\\right)\\right) B_{j}\\left(z\\left(s_{j}\\right)\\right). \\end{equation}\\] 3.4 Conditionally Specified Spatial Models 3.4.1 Models for Discrete Data Hammersley-Clifford theorem 3.3.3 is the theoretical foundation of conditionally specified spatial models for discrete data. 3.4.1.1 Binary Data Binary Data Binary data refers to data points which are either 0 or 1. Logistic function is the first thing come to ming when it comes to 0-1 binary data. One of the most used method is known as Autologistic Model. Assuming pairwise-only dependence between sites, \\(G_{i}(1) \\equiv \\alpha_{i}\\), \\(G_{i j}(1,1) \\equiv \\theta_{i j}\\), and \\(z(s_i) = 0,1\\). Autologistic Model can be writen as (3.24). \\[\\begin{equation} \\operatorname{Pr}\\left(z\\left(\\mathbf{s}_{i}\\right) \\mid\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right)=\\frac{\\exp \\left\\{\\alpha_{i} z\\left(\\mathbf{s}_{i}\\right)+\\sum_{j=1}^{n} \\theta_{i j} z\\left(\\mathbf{s}_{i}\\right) z\\left(\\mathbf{s}_{j}\\right)\\right\\}}{1+\\exp \\left\\{\\alpha_{i}+\\sum_{j=1}^{n} \\theta_{i j} z\\left(\\mathbf{s}_{j}\\right)\\right\\}} \\tag{3.24} \\end{equation}\\] Autologistic model can be easily fitted by function autologistic() in ngspatial package. As a homogeneous first-order autologistic on a countable regular latticeOne of autologistic prefered by physicist is Ising Model. It can ben summarized as \\[\\begin{equation} \\operatorname{Pr}(z(u, v) \\mid\\{z(k, l):(k, l) \\neq(u, v)\\})=\\exp (z(u, v) g) /\\{1+\\exp (g)\\} \\tag{3.25} \\end{equation}\\] where \\[\\begin{equation} \\begin{aligned} g \\equiv\\{\\alpha&amp;+\\gamma_{1}(z(u-1, v)+z(u+1, v)) \\\\ &amp;\\left.+\\gamma_{2}(z(u, v-1)+z(u, v+1))\\right\\} \\end{aligned} \\end{equation}\\] Other modelling types for binary data include Random Media, Multicolored Data and so on. 3.4.1.2 Counts Data Besag’s theorem 3.4 is the theoretical foundation for counts data. When spatial data arise as counts, the natural model that comes to mind is one based on the Poisson distribution. Assuming pairwise-only dependence between site, the auto-Poisson conditional specification is \\[\\begin{equation} \\begin{aligned} &amp;\\operatorname{Pr}\\left(z\\left(\\mathrm{~s}_{i}\\right) \\mid\\left\\{z\\left(\\mathrm{~s}_{j}\\right): j \\neq i\\right\\}\\right) \\\\ &amp;\\quad=\\exp \\left(-\\lambda_{i}\\left(\\left\\{z\\left(\\mathrm{~s}_{j}\\right): j \\neq i\\right\\}\\right)\\right)\\left(\\lambda_{i}\\left(\\left\\{z\\left(\\mathrm{~s}_{j}\\right): j \\neq i\\right\\}\\right)\\right)^{z\\left(\\mathrm{~s}_{i}\\right)} / z\\left(\\mathrm{~s}_{i}\\right) ! \\end{aligned} \\tag{3.26} \\end{equation}\\] where \\(\\lambda_{i}=\\lambda_{i}\\left(\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\in N_{i}\\right\\}\\right)\\) is a function of data observed for the regions \\(N_j\\) that neighbor the region \\(i (i = 1,..., n)\\). By Besag’s theorem 3.4, we have \\[\\begin{equation} \\lambda_{i}\\left(\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\in N_{i}\\right\\}\\right)=\\exp \\left\\{\\alpha_{i}+\\sum_{j=1}^{n} \\theta_{i j} z\\left(\\mathbf{s}_{j}\\right)\\right\\} \\tag{3.27} \\end{equation}\\] Then, \\(Q(z)\\) is derived as \\[\\begin{equation} Q(\\mathbf{z})=\\sum_{i=1}^{n} \\alpha_{i} z\\left(s_{i}\\right)+\\sum_{1 \\leq i&lt;j \\leq n} \\theta_{i j} z\\left(s_{i}\\right) z\\left(s_{j}\\right)-\\sum_{i=1}^{n} \\log \\left(z\\left(s_{i}\\right) !\\right) \\tag{3.28} \\end{equation}\\] Note that SIDS data introduced in the first part of this chapter 3.1 are suitable for auto-poisson model. 3.4.2 Models for Continuous Data 3.4.2.1 Auto-Gaussian (or CG) models Assuming that the conditional density has the Gaussian form \\[\\begin{equation} \\begin{aligned} &amp;f\\left(z\\left(\\mathbf{s}_{i}\\right) \\mid\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right) \\\\ &amp;\\quad=\\left(2 \\pi \\tau_{i}^{2}\\right)^{-1 / 2} \\exp \\left[-\\left\\{z\\left(\\mathbf{s}_{i}\\right)-\\theta_{i}\\left(\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right)\\right\\}^{2} / 2 \\tau_{i}^{2}\\right] \\end{aligned} \\tag{3.29} \\end{equation}\\] Assuming pairwise-only dependence between sites, the conditional expecta- tion \\(E\\left(Z\\left(\\mathbf{s}_{i}\\right)\\left\\{\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right) \\equiv \\theta_{i}\\left(\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right)\\right.\\) can be written as \\[\\begin{equation} \\theta_{i}\\left(\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\}\\right)=\\mu_{i}+\\sum^{n} c_{i j}\\left(z\\left(\\mathbf{s}_{j}\\right)-\\mu_{j}\\right) \\tag{3.30} \\end{equation}\\] The conditional distribution is given by \\[\\begin{equation} Z\\left(\\mathbf{s}_{i}\\right)\\left\\{\\left\\{z\\left(\\mathbf{s}_{j}\\right): j \\neq i\\right\\} \\sim \\operatorname{Gau}\\left(\\mu_{i}+\\sum_{j=1}^{n} c_{i j}\\left(z\\left(\\mathbf{s}_{j}\\right)-\\mu_{j}\\right), \\tau_{i}^{2}\\right)\\right. \\tag{3.31} \\end{equation}\\] Apply Factorization Theorem ?? directly, the joint distribution is as \\[\\begin{equation} \\mathbf{Z} \\sim \\operatorname{Gau}\\left(\\boldsymbol{\\mu},(I-C)^{-1} M\\right) \\tag{3.32} \\end{equation}\\] After the necessary derivation, we have \\(Q(z)\\) as \\[\\begin{equation} \\begin{aligned} Q(\\mathbf{z})=\\log (f(\\mathbf{z}) / f(\\mathbf{0}))=&amp;-(1 / 2)(\\mathbf{z}-\\boldsymbol{\\mu})^{\\prime} M^{-1}(I-C)(\\mathbf{z}-\\boldsymbol{\\mu}) \\\\ &amp;+(1 / 2) \\boldsymbol{\\mu}^{\\prime} M^{-1}(I-C) \\boldsymbol{\\mu} \\end{aligned} \\end{equation}\\] 3.5 Simultaneously Specified Spatial Models Simultaneous approach is popular in econometrics and graphical modeling. Whittle’s (1954) prescription for simultaneously specified stationary processes in the plane is given by equation (3.33). For a (finite) data set \\(\\mathbf{Z} \\equiv\\left(Z\\left(s_{1}\\right), \\ldots, Z\\left(s_{n}\\right)\\right)^{\\prime}\\) at locations \\(s_{1}, \\ldots, s_{n}\\), the analogous specification is \\[\\begin{equation} (I-B) \\mathrm{Z}=\\epsilon \\tag{3.33} \\end{equation}\\] where \\(\\epsilon \\equiv\\left(\\epsilon\\left(s_{1}\\right), \\ldots, \\epsilon\\left(s_{n}\\right)\\right)^{\\prime}\\) is a vector of i.i.d. zero-mean errors and \\(B\\) is a matrix whose diagonal elements \\(\\left\\{b_{i i}\\right\\}\\) are zero. Another way to write (6.7.1) is \\[\\begin{equation} Z\\left(\\mathbf{s}_{i}\\right)=\\sum_{j=1}^{n} b_{i j} Z\\left(\\mathbf{s}_{j}\\right)+\\epsilon\\left(\\mathbf{s}_{i}\\right), \\tag{3.34} \\end{eq:equation} Simultaneously specified spatial models is referred to as a spatial autoregressiue (SAR) process, which can be understood by the form of equation \\@ref(eq:ss2) A common special case occurs when $\\epsilon$ is Gaussian, then we have \\begin{equation} \\mathbf{Z} \\sim \\operatorname{Gau}\\left(\\mathbf{0},(I-B)^{-1}\\left(I-B^{\\prime}\\right)^{-1} \\sigma^{2}\\right) \\tag{3.35} \\end{equation}\\] 3.5.1 Spatial Autoregressive Regression Model If it is desired to interpret large-scale effects \\(\\boldsymbol{\\beta}\\) through \\(E(\\mathbf{Z})=X \\boldsymbol{\\beta}\\) (where the columns of \\(X\\) might be treatments, spatial trends, factors, etc.), then the model should be modified to \\[\\begin{equation} (I-B)(\\mathbf{Z}-X \\boldsymbol{\\beta})=\\boldsymbol{\\epsilon} \\tag{3.36} \\end{equation}\\] When \\(\\epsilon\\) is Gaussian, \\[\\begin{equation} \\mathbf{Z} \\sim \\operatorname{Gau}\\left(X \\boldsymbol{\\beta},(I-B)^{-1}\\left(I-B^{\\prime}\\right)^{-1} \\sigma^{2}\\right) \\tag{3.37} \\end{equation}\\] 3.6 Space-Time Models Space-Time models consider the case when not only space but also time should also be taken into acount. 3.6.1 STARMA Model the STARMA model is summarized as \\[\\begin{equation} \\begin{aligned} \\mathbf{Z}(t) &amp;=\\sum_{k=0}^{p}\\left(\\sum_{j=1}^{\\lambda_{k}} \\xi_{k j} W_{k j}\\right) \\mathbf{Z}(t-k)-\\sum_{l=0}^{q}\\left(\\sum_{j=1}^{\\mu_{l}} \\phi_{l j} V_{l j}\\right) \\boldsymbol{\\epsilon}(t-l)+\\boldsymbol{\\epsilon}(t) \\\\ &amp;=\\sum_{k=0}^{p} B_{k} \\mathbf{Z}(t-k)+\\boldsymbol{\\epsilon}(t)-\\sum_{l=0}^{q} E_{l} \\boldsymbol{\\epsilon}(t-l) \\end{aligned} \\tag{3.38} \\end{equation}\\] where \\(W_{k j}\\) and \\(V_{l j}\\): given weight matrices, \\(\\lambda_{k}\\): the extent of the spatial lagging on the autoregressive component, \\(\\mu_{l}\\): the extent of the spatial lagging on the moving-average component, \\(\\left\\{\\xi_{k j}\\right\\}\\) and \\(\\left\\{\\phi_{l j}\\right\\}\\): the STARMA parameters to be estimated (restrictions are needed on the \\(W\\) s and \\(V\\) s to ensure these parameters are identifiable). \\(B_{0}, E_{0}\\): necessarily have zeros down their diagonals. "],["inference-for-lattice-models.html", "Chapter 4 Inference for Lattice Models 4.1 Parameter Estimation for Lattice Models 4.2 Conditional Gaussian Model 4.3 Auto-logistic Model 4.4 Auto-Poisson Model", " Chapter 4 Inference for Lattice Models 4.1 Parameter Estimation for Lattice Models 4.1.1 Pseudolikelihood Pseudolikelihood Pseudolikelihood is to be writen as \\[\\begin{equation} p(\\boldsymbol{\\eta})=\\prod_{i=1}^{n} \\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\} ; \\boldsymbol{\\eta}\\right) \\tag{4.1} \\end{equation}\\] Also denote the negative log-pseudolikelihood function as \\[\\begin{equation} P(\\boldsymbol{\\eta})=-\\log (p(\\boldsymbol{\\eta}))=-\\sum_{i=1}^{n} \\log \\mathbf{P}\\left(z\\left(s_{i}\\right) \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\} ; \\boldsymbol{\\eta}\\right) \\tag{4.2} \\end{equation}\\] The goal is to maximizing p seudolikelihood (??). Equally, we aims to find \\(\\hat \\eta_p\\) which minimize formula (4.2). 4.1.2 Gaussian Maximum Likelihood Estimation Under Gaussian assumptions, The SG and CG model can be estimated by maximum likelihood method. If \\(\\mathbf{Z} \\sim \\mathrm{N}(\\boldsymbol{\\mu}, \\sigma)\\), the negative log-likelihood is \\[\\begin{equation} L(\\boldsymbol{\\eta})=\\frac{n}{2} \\log (2 \\pi)+\\frac{1}{2} \\log (|\\Sigma|)+\\frac{1}{2}(\\mathbf{z}-\\boldsymbol{\\mu})^{\\top} \\Sigma^{-1}(\\mathbf{z}-\\boldsymbol{\\mu}) \\tag{4.3} \\end{equation}\\] For the covariance matrix, \\[\\begin{equation} \\begin{array}{ll} \\text { SG : } &amp; \\Sigma=(I-B)^{-1} \\Lambda\\left(I-B^{\\prime}\\right)^{-1} \\\\ \\text { CG : } &amp; \\Sigma=(I-C)^{-1} M \\end{array} \\tag{4.4} \\end{equation}\\] 4.2 Conditional Gaussian Model Recall Conditional Gaussian Model introduced in section 3.2.2.2. The negative log-pseudolikelihood function here is \\[\\begin{equation} P(\\boldsymbol{\\eta})=\\frac{1}{2} \\sum_{i=1}^{n} \\frac{\\left(z\\left(s_{i}\\right)-\\theta\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)\\right)^{2}}{\\tau_{i}^{2}}+\\log \\left(2 \\pi \\tau_{i}^{2}\\right) \\tag{4.5} \\end{equation}\\] where \\(\\theta\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=\\mu_{i}+\\sum_{j=1}^{n} c_{i j}\\left(z\\left(s_{j}\\right)-\\mu_{j}\\right) .\\) It can be seen from forumula (4.5) that The maximum pseudolikelihood estimator is a weighted least squares estimator under heterogeneous variances \\(\\tau_i\\) If \\(\\tau_{i}^{2} \\equiv \\sigma^{2}\\) for all \\(i=1, \\cdots, n\\), then maximum pseudolikelihood estimator is the ordinary least squares estimator. Now that we have the goal function, MLE illustrated in section 4.1.2 can be applied for parameter estimation 4.3 Auto-logistic Model The conditional distribution is \\[\\begin{equation} \\operatorname{logit}\\left(Z\\left(s_{i}\\right)=1 \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=\\alpha_{i}+\\sum_{j=1}^{n} \\theta_{i j} z\\left(s_{j}\\right) . \\tag{4.6} \\end{equation}\\] Consider again the isotropic Ising model \\(\\gamma_{1}=\\gamma_{2}=\\gamma\\), the model is simplified to \\[\\begin{equation} \\operatorname{logit}\\left(Z\\left(s_{i}\\right)=1 \\mid\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)=\\alpha+\\gamma n_{i} . \\tag{4.7} \\end{equation}\\] Estimation: parameters can be estimated by a logistic regression with pseudo-data \\(\\left\\{\\left(z_{i}, n_{i}\\right), i=1, \\cdots, n\\right\\}\\). 4.4 Auto-Poisson Model The negative log-likelihood \\[\\begin{equation} \\begin{aligned} \\mathbf{P}\\left(\\left\\{\\alpha_{i}\\right\\},\\left\\{\\theta_{i j}\\right\\}\\right) &amp;=\\sum_{i=1}^{n} \\lambda_{i}\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right) \\\\ &amp;-z\\left(s_{i}\\right) \\log \\left(\\lambda_{i}\\left(\\left\\{z\\left(s_{j}\\right): j \\neq i\\right\\}\\right)\\right)+\\log \\left(z\\left(s_{i}\\right) !\\right), \\end{aligned} \\tag{4.8} \\end{equation}\\] which is a Poisson regression model. "],["spatial-analysis-homework.html", "Chapter 5 Spatial Analysis Homework 5.1 Overview 5.2 Exploratory Analysis 5.3 Model Fitting 5.4 Animation", " Chapter 5 Spatial Analysis Homework 5.1 Overview 5.1.1 Background Temperature is a variable highly related to locations. In most cases, places near to each other share similar average temperature, no matter what unit is the average (daily average, monthly average etc.) With temperature and geographic information of Chicago, some spatial analysis is explored. 5.1.2 Data The data is from AoT Workshop of the Center for Spatial Data Science at the University of Chicago. The dataset includes geographic information (latitude and longitude) and direct temperature measurement data recorded from temperature sensors of 90 spots in Chicago, August 25, 2018. For more information about the AoT Workshop and to download the data, please visit https://geodacenter.github.io/aot-workshop/. The overview of data is as below. (For presentation formatting, node id, which links tables, is omitted) nodes &lt;- read.csv(&quot;../../Data/nodes.csv&quot;) colnames_tmp &lt;- c(&quot;project_id&quot;, &quot;lat&quot;, &quot;lon&quot;, &quot;start_timestamp&quot;) head(nodes[colnames_tmp]) %&gt;% kbl() %&gt;% kable_material(c(&quot;striped&quot;, &quot;hover&quot;)) project_id lat lon start_timestamp AoT_Chicago 41.87838 -87.62768 2017/10/09 00:00:00 AoT_Chicago 41.85814 -87.61606 2017/08/08 00:00:00 AoT_Chicago 41.81034 -87.59023 2017/08/08 00:00:00 AoT_Chicago 41.89196 -87.61160 2017/12/01 00:00:00 AoT_Chicago 41.78060 -87.58646 2018/02/26 00:00:00 AoT_Chicago 41.85218 -87.67583 2017/12/15 00:00:00 sensor &lt;- read.csv(&quot;../../Data/data.csv.gz&quot;) colnames_tmp &lt;- c(&quot;subsystem&quot;, &quot;sensor&quot;, &quot;parameter&quot;, &quot;value_raw&quot;,&quot;value_hrf&quot;) head(sensor[colnames_tmp]) %&gt;% kbl() %&gt;% kable_material(c(&quot;striped&quot;, &quot;hover&quot;)) subsystem sensor parameter value_raw value_hrf metsense bmp180 pressure 9909900 990.99 metsense bmp180 temperature NA 19.40 metsense htu21d humidity NA 79.37 metsense htu21d temperature NA 19.42 metsense tsys01 temperature NA 20.04 metsense bmp180 pressure 11016512 1015.59 sensor_info &lt;- read.csv(&quot;../../Data/sensors.csv&quot;) colnames_tmp &lt;- c(&quot;subsystem&quot;, &quot;sensor&quot;, &quot;parameter&quot;, &quot;hrf_unit&quot;, &quot;hrf_minval&quot;, &quot;hrf_maxval&quot;) head(sensor_info[colnames_tmp]) %&gt;% kbl() %&gt;% kable_material(c(&quot;striped&quot;, &quot;hover&quot;)) subsystem sensor parameter hrf_unit hrf_minval hrf_maxval metsense htu21d humidity RH 0 100 metsense bmp180 pressure hPa 300 1100 metsense bmp180 temperature C -40 85 metsense htu21d temperature C -40 125 metsense tsys01 temperature C -40 125 5.1.3 Goal Practice theoretical knowledge related to geostatistics concepts, such as variogram and kriging model. Apply kriging model in real data with help of AoT Workshop tutorial. Interpolate a temperature surface in the area. Familiar myself with gridding tricks. Explore visualization while presenting results of spatial statistics model. 5.2 Exploratory Analysis Two things are addressed in this part: Data preprocessing: filter the data we are interested. Descriptive statistics: draw plots or tables to be familiar with data and variables. 5.2.1 Data Preprocessing Not all sensors record the temperature, humidity and pressure are also measured in out dataset. To cancel redundancy and to uniform standard of measurement, we select only sensor of type “tsys01.” “value_hrf” is the transformed recording of sensors. The unit of it is Celsius degree. It can be used directly for computing average temperature. Suppose we are only interest in average temperature of second half of the day. Recordings in the mornings should be eliminated. sensor &lt;- sensor %&gt;% filter(sensor == &quot;tsys01&quot;) # timestamp sensor$timestamp2 &lt;- ymd_hms(sensor$timestamp) sensor$hour &lt;- hour(sensor$timestamp) sensor &lt;- sensor %&gt;% filter(hour(timestamp2) &gt;= 12) %&gt;% group_by(node_id) %&gt;% summarize(avg_temp = mean(value_hrf)) Now we take out the faulty sensor with apparently fault average temperature. sensor$avg_temp ## [1] 26.012653 25.879479 28.302872 25.967144 27.939340 25.517123 27.497169 ## [8] 29.305905 25.850505 27.028029 7.879993 28.152182 28.858535 25.913236 ## [15] 28.164899 26.645538 27.566751 27.299922 29.175229 26.378803 26.941640 ## [22] 26.222689 26.964437 25.908585 26.734579 28.866217 26.185707 26.065050 ## [29] 25.545073 27.256887 25.892882 27.382421 sensor &lt;- sensor %&gt;% filter(avg_temp &gt; 15) After these steps, size of data frame sensor is rapidly reduced from the original 497,912 to 32. The data frame now indicates average temperatures in the afternoon of 31 distinct sensor spots. Sensor data is already now. Merge sensor data with geographic location Then, convert the completed node data to spatial object format for plotting and more advanced spatial analytics. nodes &lt;- merge(sensor, nodes, by = c(&quot;node_id&quot;)) coordinates(nodes) &lt;- nodes[,c(&quot;lon&quot;, &quot;lat&quot;)] proj4string(nodes) &lt;- CRS(&quot;+init=epsg:4326&quot;) 5.2.2 Descriptive Statistics For the data is spatial, the most direct way is to plot a map. tmap_mode(&quot;view&quot;) tm_shape(nodes) + tm_dots() From the map, we can get a general idea of the sensor position. Chicago community area is the domain of the model. Recall the random process \\(\\{Z(s), s\\in D\\}\\), which is the object of spatial analysis. The goal is to interpolate a temperature surface in \\(D\\). It is helpful to plot community area as well. chiCA &lt;- readOGR(&quot;../../Data&quot;,&quot;ChiComArea&quot;) # generated by the workshop ## OGR data source with driver: ESRI Shapefile ## Source: &quot;D:\\Ryanna\\RUC_courses\\R_Y1_1\\Geometrics\\Data&quot;, layer: &quot;ChiComArea&quot; ## with 77 features ## It has 4 fields ## Integer64 fields read as strings: ComAreaID tmap_mode(&quot;view&quot;) tm_shape(chiCA) + tm_borders() + tm_shape(nodes) + tm_dots(col=&quot;avg_temp&quot;,size=0.3, title=&quot;Average Temperature (C)&quot;) in Chicago community area (namely, \\(D\\)), temperature sensors are not clustered, which is good for modeling. 5.3 Model Fitting 5.3.1 Variogram As an important parameter for spatial modeling, variogram has to be studied. v &lt;- variogram(nodes$avg_temp ~ 1, nodes) plot(v) Observe the variogram, it seems spherical semivariogram (5.1), exponential variogram (5.2) can be suitable for the data. Spherical Semivariogram \\begin{equation} ( ; )= \\[\\begin{cases}0, &amp; \\mathbf{h}=\\mathbf{0}, \\\\ c_{0}+c_{s}\\left\\{(3 / 2)\\left(\\|\\mathbf{h}\\| / a_{s}\\right)-(1 / 2)\\left(\\|\\mathbf{h}\\| / a_{s}\\right)^{3}\\right\\}, &amp; 0&lt;\\|\\mathbf{h}\\| \\leq a_{s}, \\\\ c_{0}+c_{s}, &amp; \\|\\mathbf{h}\\| \\geq a_{s},\\end{cases}\\] \\(\\theta=\\left(c_{0}, c_{s}, a_{s}\\right)^{\\prime}\\), \\tag{5.1} \\end{equaton} where \\(c_{0} \\geq 0, c_{s} \\geq 0\\), and \\(a_{s} \\geq 0\\). Exponential Variogram \\[\\begin{equation} \\gamma(\\mathbf{h} ; \\boldsymbol{\\theta})= \\begin{cases}0, &amp; \\mathbf{h}=\\mathbf{0} \\\\ c_{0}+c_{e}\\left\\{1-\\exp \\left(-\\|\\mathbf{h}\\| / a_{e}\\right)\\right\\}, &amp; \\mathbf{h} \\neq \\mathbf{0}\\end{cases}$ $\\theta=\\left(c_{0}, c_{e}, a_{e}\\right)^{\\prime}$, \\tag{5.2} \\end{equation}\\] where \\(c_{0} \\geq 0, c_{e} \\geq 0\\), and $a_{e} . v_fit_sph &lt;- fit.variogram(v, model = vgm(&quot;Sph&quot;)) plot(v, v_fit_sph) v_fit_exp &lt;- fit.variogram(v, model = vgm(&quot;Exp&quot;)) plot(v, v_fit_exp) It is hard to choose the variogram model. We might as well adopt the relatively simpler exponential variogram for the following modeling. 5.3.2 Kriging Model Gridding and projection should be performed before modeling kriging. chi_grid &lt;- pt2grid((chiCA), 200) # self-defined pt2grid for griding (omitted) projection(chi_grid) &lt;- CRS(&quot;+init=epsg:4326&quot;) projection(nodes) &lt;- CRS(&quot;+init=epsg:4326&quot;) projection(chiCA) &lt;- CRS(&quot;+init=epsg:4326&quot;) Then ordinary kriging model (illustrated in section 2.2) is fitted here. kg &lt;- krige(nodes$avg_temp ~ 1, nodes, chi_grid, model = v_fit_exp) ## [using ordinary kriging] plot(kg) Clip the whole map to Chicago boundaries. chi_kg &lt;- kg[chiCA,] plot(chi_kg) Combine the predicted temperature surface, community area and sensor information, the results can be plotted nicely as tm_shape(chi_kg) + tm_raster(&quot;var1.pred&quot;, style = &quot;jenks&quot;, title = &quot;Temperature (C)&quot;, palette = &quot;BuPu&quot;) + tm_shape(nodes) + tm_dots(size=0.01) + tm_layout(main.title = &quot;Avg Afternoon Temperature August 25&quot;, main.title.size = 1.1) + tm_legend(position = c(&quot;left&quot;, &quot;bottom&quot;)) 5.4 Animation The analysis above interpolate average temperature of Augest 25, 2018. If we are interested in hourly average temperature, we can fit 24 models using the data. An animation of hourly change of temperature in Chicago is as below. In practice, animation like this is informative and common. One main further modification of this animation is to uniform legend scale of different hour "],["references.html", "References", " References Cressie N. Statistics for spatial data[M]. John Wiley &amp; Sons, 2015. Lecture slides by Wu Wang, Renmin University of China "]]
